<div class="d-flex flex-column min-vh-100" style="background: linear-gradient(to bottom, #1e1e1e 0%, #121212 100%);">

  <!-- Navbar -->
  <nav class="d-flex align-items-center justify-content-between px-4 py-3 sticky-top"
    style="background-color: rgba(0,0,0,0.7); backdrop-filter: blur(10px); z-index: 1000;">
    <div class="d-flex align-items-center gap-4">
      <button class="btn btn-link text-decoration-none text-white p-0" (click)="goBack()">
        <span class="fs-4">‚Üê</span>
      </button>
      <span class="fw-bold fs-5 text-white" *ngIf="album">{{ album.name }}</span>
    </div>
    <button class="btn btn-sm text-decoration-none fw-bold text-white" (click)="goHome()">Home</button>
  </nav>

  <div class="container-fluid p-0 flex-grow-1">

    <!-- Loading/Error -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border text-success" role="status"></div>
    </div>

    <div *ngIf="errorMessage" class="container mt-4">
      <div class="alert alert-danger"
        style="background: rgba(229, 9, 20, 0.1); border: 1px solid var(--text-negative); color: var(--text-negative);">
        {{ errorMessage }}
      </div>
    </div>

    <!-- Album Content -->
    <div *ngIf="album && !loading">

      <!-- Hero Section -->
      <div class="d-flex align-items-end p-4 p-lg-5"
        style="background: linear-gradient(to bottom, #404040, #121212); height: 340px;">
        <div class="d-flex align-items-end gap-4 w-100">
          <!-- Album Art -->
          <div class="shadow-lg d-flex align-items-center justify-content-center rounded"
            style="width: 232px; height: 232px; background: #282828; font-size: 5rem; min-width: 232px;">
            üíø
          </div>

          <div class="mb-2">
            <span class="text-white small fw-bold text-uppercase">Album</span>
            <h1 class="display-3 fw-bold text-white mb-2" style="letter-spacing: -0.04em;">{{ album.name }}</h1>
            <div class="d-flex align-items-center gap-2 text-white opacity-75 small">
              <span class="fw-bold">Artist Name</span> <!-- Ideally we fetch artist name here -->
              <span>‚Ä¢</span>
              <span>{{ album.date | date:'yyyy' }}</span>
              <span>‚Ä¢</span>
              <span>{{ songs.length }} songs</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Bar -->
      <div class="px-4 py-3 d-flex align-items-center gap-4" style="background: #121212;">
        <button class="btn btn-lg rounded-circle d-flex align-items-center justify-content-center p-0"
          style="width: 56px; height: 56px; background-color: var(--brand-color); border: none; color: black;"
          onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'"
          (click)="playAll()" title="Play all">
          <span class="fs-3">‚ñ∂</span>
        </button>

        <button class="btn btn-outline-light rounded-circle p-2 border-0" style="opacity: 0.7;">
          <span class="fs-4">‚ô°</span> <!-- Like/Save Placehoder -->
        </button>
      </div>

      <!-- Tracklist Header -->
      <div class="px-4 pb-2" style="background: #121212;">
        <div class="d-flex text-subdued border-bottom border-secondary pb-2 mb-2 px-3 small text-uppercase">
          <div style="width: 40px;">#</div>
          <div class="flex-grow-1">Title</div>
          <div class="text-end" style="width: 120px;">Rating</div>
          <div class="text-end" style="width: 60px;">üïí</div>
        </div>
      </div>

      <!-- Tracklist -->
      <div class="px-4 pb-5" style="background: #121212;">
        <div *ngIf="songs.length === 0" class="text-subdued px-3">
          No songs in this album.
        </div>

        <div *ngFor="let song of songs; let i = index"
          class="d-flex align-items-center px-3 py-2 rounded position-relative track-row"
          style="cursor: pointer; transition: background-color 0.2s;"
          onmouseover="this.style.backgroundColor='#2a2a2a'; this.querySelector('.play-icon').style.display='inline'; this.querySelector('.track-num').style.display='none';"
          onmouseout="this.style.backgroundColor='transparent'; this.querySelector('.play-icon').style.display='none'; this.querySelector('.track-num').style.display='inline';"
          (click)="playSong(song, i)">

          <div class="text-subdued me-3 d-flex justify-content-center" style="width: 16px;">
            <span class="track-num">{{ i + 1 }}</span>
            <span class="play-icon text-white" style="display: none;">‚ñ∂</span>
          </div>

          <div class="flex-grow-1">
            <div class="text-white" style="font-size: 1rem;">{{ song.name }}</div>
            <div class="text-subdued small" *ngIf="getSongCount(song.id!) > 0">
              Avg: {{ getSongAverage(song.id!).toFixed(1) }} ‚òÖ ({{ getSongCount(song.id!) }})
            </div>
          </div>

          <!-- Interactive Rating -->
          <div class="d-flex align-items-center justify-content-end gap-1 me-4">
            <span *ngFor="let star of [1,2,3,4,5]" [class.text-warning]="star <= getMyRating(song.id!)"
              [class.text-secondary]="star > getMyRating(song.id!)" style="cursor: pointer; font-size: 1rem;"
              (click)="$event.stopPropagation(); rateSong(song.id!, star)">
              {{ star <= getMyRating(song.id!) ? '‚òÖ' : '‚òÜ' }} </span>
                <button *ngIf="getMyRating(song.id!) > 0"
                  class="btn btn-link text-danger p-0 ms-2 text-decoration-none small"
                  (click)="$event.stopPropagation(); deleteRating(song.id!)">
                  ‚úï
                </button>
          </div>

          <div class="text-subdued text-end small" style="width: 50px;">
            {{ formatDuration(song.duration) }}
          </div>

        </div>
      </div>

    </div>
  </div>
</div>